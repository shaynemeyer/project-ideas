# Database Schema (Entity Relationship Diagram)

This ERD shows the complete database schema for the SSL Certificate Tracking System using Drizzle ORM with PostgreSQL.

```mermaid
erDiagram
    CERTIFICATES ||--o{ CERTIFICATE_HISTORY : has
    CERTIFICATES ||--o{ ALERTS : generates
    USERS ||--o{ ALERTS : acknowledges
    
    CERTIFICATES {
        uuid id PK
        varchar domain UK
        varchar common_name
        varchar issuer
        timestamp valid_from
        timestamp valid_to
        integer days_until_expiry
        varchar status
        timestamp last_checked
        integer check_interval
        jsonb alert_thresholds
        boolean is_active
        text notes
        timestamp created_at
        timestamp updated_at
    }
    
    CERTIFICATE_HISTORY {
        uuid id PK
        uuid certificate_id FK
        timestamp valid_from
        timestamp valid_to
        varchar issuer
        timestamp checked_at
        text error
    }
    
    ALERTS {
        uuid id PK
        uuid certificate_id FK
        varchar alert_type
        text message
        integer days_remaining
        timestamp sent_at
        boolean acknowledged
        timestamp acknowledged_at
        varchar acknowledged_by
    }
    
    USERS {
        uuid id PK
        varchar email UK
        varchar name
        varchar role
        boolean receive_alerts
        timestamp created_at
    }
    
    NOTIFICATION_SETTINGS {
        uuid id PK
        boolean email_enabled
        boolean slack_enabled
        varchar slack_webhook
        varchar webhook_url
        timestamp updated_at
    }
```

## Table Descriptions

### CERTIFICATES
Primary table storing SSL certificate information for monitored domains.
- **Unique Constraint**: domain (each domain can only be tracked once)
- **Status Values**: active, expiring, expired, error
- **alert_thresholds**: JSON array of days [30, 14, 7, 1] when to send alerts

### CERTIFICATE_HISTORY
Historical record of certificate checks and renewals for audit trail.
- Tracks certificate changes over time
- Records errors for troubleshooting

### ALERTS
All alerts generated by the system, including acknowledgment tracking.
- **Alert Types**: expiry_warning, expired, error
- Links to the user who acknowledged the alert

### USERS
User accounts with role-based access control.
- **Roles**: admin (full access), editor (manage certificates), viewer (read-only)
- Controls who receives alert notifications

### NOTIFICATION_SETTINGS
Global notification configuration for the system.
- Single-row table (singleton pattern)
- Stores webhook URLs and channel enablement flags
